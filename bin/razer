#!/usr/bin/env bash

function rzr()
{
    razer-cli "$@" > /dev/null 2>&1
}

# Turn off the logo
rzr write logo ac 0
rzr write logo bat 0

# Auto fan on AC/Bat
rzr write fan ac 0
rzr write fan bat 0

# Subtle keyboard brightness
rzr write brightness ac 10
rzr write brightness bat 10

powerName="Unknown"
icon=""

case "$1" in
    balance | 0)
        # White keyboard, subtle
        rzr standard-effect static 255 255 255

        # Balanced power profile
        rzr write power ac 0
        rzr write power bat 0

        powerName="Balanced"
        icon="power-mode-balance"
    ;;
    gaming | 1)
        # White keyboard, subtle
        rzr standard-effect static 255 0 10

        # Brighten the keys
        rzr write brightness ac 20
        rzr write brightness bat 20

        # Game mode - GPU focus
        rzr write power ac 1
        rzr write power bat 1

        powerName="Gaming"
        icon="power-mode-game"
    ;;
    cpu | 2)
        # CPU Focus - blueish like intel
        rzr standard-effect static 20 70 255

        # Brighten the keys
        rzr write brightness ac 20
        rzr write brightness bat 20

        # Custom: low GPU, boost CPU
        rzr write power ac 4 3 0
        rzr write power bat 4 3 0

        powerName="CPU Boost"
        icon="power-mode-cpu"
     ;;
    gpu | 2)
        # GPU Focus - greenish nvidia color
        rzr standard-effect static 20 255 10

        # Brighten the keys
        rzr write brightness ac 20
        rzr write brightness bat 20

        # Custom: low GPU, boost CPU
        rzr write power ac 4 0 2
        rzr write power bat 4 0 2

        powerName="GPU Boost"
        icon="power-mode-gpu"
     ;;
    restart | st)
        echo "Stopping daemon"
        systemctl --user stop razerdaemon
        rm -f /tmp/razercontrol-socket
        echo "Starting daemon"
        systemctl --user start razerdaemon
        systemctl --user status razerdaemon
    ;;
    status | st)
        razer-cli read power ac
    ;;
    *)
        echo "razer balance|gaming|creator|boost|status"
        exit 0
    ;;
esac


dunstify -a "Razer Control" -u low -i "$icon" -r "75924" "Razer Power Mode" "$powerName"

